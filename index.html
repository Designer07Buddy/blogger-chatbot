<!doctype html>
<html lang="en">
<head>
<style>
#chatbot {position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:#4CAF50;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 6px 12px rgba(0,0,0,0.3);z-index:9999;font-size:28px;transition:all 0.3s ease;user-select:none;}
#chatbot:hover {transform:scale(1.1);box-shadow:0 8px 16px rgba(0,0,0,0.4);}
#chatbot-window {position:fixed;bottom:90px;right:20px;width:350px;max-width:90%;height:500px;background:white;border-radius:12px;box-shadow:0 12px 24px rgba(0,0,0,0.25);display:none;flex-direction:column;overflow:hidden;font-family:Poppins,sans-serif;color:#000;z-index:9999;}
#chatbot-header {background:#4CAF50;color:white;padding:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center;font-size:16px;border-top-left-radius:12px;border-top-right-radius:12px;}
#chatbot-header span{cursor:pointer;font-weight:700;}
#chatbot-messages {flex:1;padding:12px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;font-size:14px;}
.message {padding:8px 12px;border-radius:10px;max-width:80%;word-wrap:break-word;}
.bot {background:#f1f1f1;color:#000;align-self:flex-start;}
.user {background:#4CAF50;color:#fff;align-self:flex-end;}
.typing {font-style:italic;color:#888;}
#chatbot-input-area {display:flex;padding:10px;border-top:1px solid #ddd;}
#chatbot-input {flex:1;padding:8px 10px;border-radius:8px;border:1px solid #ccc;outline:none;font-size:14px;}
#chatbot-send {background:#4CAF50;color:white;border:none;padding:7px 14px;margin-left:6px;border-radius:8px;cursor:pointer;transition:background 0.3s;}
#chatbot-send:hover {background:#45a049;}
</style>
</head>
<body>

<div id="chatbot">ðŸ’¬</div>

<div id="chatbot-window">
  <div id="chatbot-header">
    Chat with me
    <div>
      <span id="chatbot-restart">ðŸ”„</span>
      <span id="chatbot-close">âœ–</span>
    </div>
  </div>
  <div id="chatbot-messages"></div>
  <div id="chatbot-input-area">
    <input id="chatbot-input" type="text" placeholder="Type a message..." />
    <button id="chatbot-send">Send</button>
  </div>
</div>

<script>
const pricing = {
  "Basic Logo": 20,
  "Standard Logo": 40,
  "Premium Brand Identity": 80,
  "Starter Social Pack": 15,
  "Growth Social Pack": 30,
  "Business Social Pack": 50,
  "Flyer / Poster": 15,
  "Brochure (Bi-Fold / Tri-Fold)": 25,
  "Banner / Ad Design": 10,
  "Basic Label": 20,
  "Premium Packaging": 40,
  "Simple Illustration": 25,
  "Detailed Illustration": 50,
  "Vehicle Wrap": 30,
  "Vectorization": 10,
  "Photo Editing": "5/image",
  "Business Card": 15
};

// Elements
const botBtn = document.getElementById('chatbot');
const windowEl = document.getElementById('chatbot-window');
const closeBtn = document.getElementById('chatbot-close');
const restartBtn = document.getElementById('chatbot-restart');
const messages = document.getElementById('chatbot-messages');
const input = document.getElementById('chatbot-input');
const sendBtn = document.getElementById('chatbot-send');

// Helpers
function appendMessage(text, sender='bot'){
  const div = document.createElement('div');
  div.className = 'message ' + sender;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}
function appendTyping(){
  const div = document.createElement('div');
  div.className = 'message bot typing';
  div.textContent = '...';
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
  return div;
}

// AI request (calls your Netlify function)
async function getAIResponse(message){
  // Check pricing first
  for(const service in pricing){
    if(message.toLowerCase().includes(service.toLowerCase())){
      return `The price for ${service} is $${pricing[service]}.`;
    }
  }
  try{
    const res = await fetch("https://your-netlify-site.netlify.app/.netlify/functions/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });
    const data = await res.json();
    return data.reply;
  } catch(e){
    return "Sorry, something went wrong.";
  }
}

// Events
botBtn.addEventListener('click', ()=>{
  windowEl.style.display = windowEl.style.display==='flex'?'none':'flex';
  if(windowEl.style.display==='flex' && messages.children.length===0){
    const typingDiv = appendTyping();
    setTimeout(()=>{
      messages.removeChild(typingDiv);
      appendMessage('Hello! ðŸ‘‹ I am your design assistant. Ask me anything or about pricing.');
    },800);
  }
});
closeBtn.addEventListener('click', ()=>windowEl.style.display='none');
restartBtn.addEventListener('click', ()=>{
  messages.innerHTML='';
  const typingDiv = appendTyping();
  setTimeout(()=>{
    messages.removeChild(typingDiv);
    appendMessage('Chat restarted. Ask me anything!');
  },800);
});
sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });

async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  appendMessage(text,'user');
  input.value='';
  const typingDiv = appendTyping();
  const response = await getAIResponse(text);
  setTimeout(()=>{
    messages.removeChild(typingDiv);
    appendMessage(response,'bot');
  },800);
}
</script>
</body>
</html>
